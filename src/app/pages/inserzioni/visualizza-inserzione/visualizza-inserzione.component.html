@if (caricamento) {
  <div class="loading">Caricamento inserzione...</div>
}

@if (!caricamento && inserzione) {
  <div class="container-inserzione">

    <div class="header">
      <h1>{{ inserzione.dati.titolo }}</h1>
      <div class="prezzo-dettaglio">
        {{ inserzione.dati.prezzo | currency:'EUR':'symbol':'1.0-0' }}
      </div>
    </div>

    <button class="proposta-btn" (click)="toggleFormOfferta()">
      ðŸ’¶ Fai un'offerta
    </button>

    <!-- CONTROPROPOSTA AGENTE -->
    @if (contropropostaAgente && contropropostaAgente.stato === 'CONTROPROPOSTA') {
      <div class="controproposta-card">
        <h3>Controproposta dell'agente</h3>

        <p>
          <strong>Importo:</strong>
          {{ contropropostaAgente.importo | currency:'EUR':'symbol':'1.0-0' }}
        </p>

        @if (contropropostaAgente.messaggio) {
          <p>
            <strong>Note:</strong><br>
            {{ contropropostaAgente.messaggio }}
          </p>
        }

        <div class="azioni-controproposta">
          <button class="btn-accetta" (click)="accettaControproposta()">âœ” Accetta</button>
          <button class="btn-rifiuta" (click)="rifiutaControproposta()">âœ– Rifiuta</button>
        </div>
      </div>
    }

    <!-- MODAL OFFERTA -->
    @if (mostraFormOfferta) {
      <div class="overlay" (click)="toggleFormOfferta()"></div>

      <div class="modal-card">
        <h2>Invia una proposta</h2>

        <form [formGroup]="offertaForm" (ngSubmit)="inviaProposta()">

          <label>Importo offerta (â‚¬)</label>
          <input
            type="text"
            class="input-field"
            formControlName="prezzoProposta"
            appCurrencyInput />

          <div class="text-muted mt-1">
            Prezzo minimo accettato:
            <strong>{{ prezzoMinimoAccettato | currency:'EUR' }}</strong>
          </div>

          @if (prezzoProposta?.touched && prezzoProposta?.invalid) {
            <div class="text-danger mt-1">
              Inserisci un importo valido
            </div>
          }

          <label>Note (opzionale)</label>
          <textarea formControlName="note" class="textarea-field"></textarea>

          <button class="submit-btn" type="submit">Invia proposta</button>
          <button class="close-btn" type="button" (click)="toggleFormOfferta()">Chiudi</button>
        </form>
      </div>
    }

    <div class="galleria" *ngIf="inserzione.foto.length">
      <img class="foto-principale" [src]="inserzione.foto[0].url"  alt=""/>
    </div>

    <div class="descrizione">
      <h3>Descrizione</h3>
      <p>{{ inserzione.dati.descrizione }}</p>
    </div>

    <div class="posizione">
      <h3>Posizione</h3>
      <iframe width="100%" height="300" [src]="mappaUrl"></iframe>
    </div>

  </div>
}
