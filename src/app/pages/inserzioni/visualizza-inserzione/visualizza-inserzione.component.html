<!-- ===================== CARICAMENTO ===================== -->
@if (caricamento) {
  <div class="loading">
    Caricamento inserzione...
  </div>
}

<!-- ===================== CONTENUTO ===================== -->
@if (!caricamento && inserzione) {
  <div class="container-inserzione">

    <!-- HEADER -->
    @if (inserzione.dati) {
      <div class="header">
        <h1>{{ inserzione.dati.titolo }}</h1>

        <div class="prezzo-dettaglio">
          {{ inserzione.dati.prezzo | currency:'EUR':'symbol':'1.0-0' }}
        </div>
      </div>
    }

    <!-- Bottone Offerta -->
    <button class="proposta-btn" (click)="toggleFormOfferta()">
      ðŸ’¶ Fai un'offerta
    </button>

    <!-- ===================== MODAL ======================= -->
    @if (mostraFormOfferta) {

      <div class="overlay" (click)="toggleFormOfferta()"></div>

      <div class="modal-card">
        <h2>Invia una proposta</h2>

        <form [formGroup]="offertaForm" (ngSubmit)="inviaProposta()">

          <label>Importo offerta (â‚¬)</label>
          <input
            type="text"
            class="input-field"
            formControlName="prezzoProposta"
            appCurrencyInput />

          @if (prezzoProposta?.touched && prezzoProposta?.invalid) {
            <div class="validation">
              Minimo accettato:
              <strong>
                {{ prezzoMinimo | currency:'EUR':'symbol':'1.0-0' }}
              </strong>
            </div>
          }

          <label>Note (opzionale)</label>
          <textarea
            formControlName="note"
            class="textarea-field">
          </textarea>

          <button class="submit-btn" type="submit">
            Invia proposta
          </button>

          <button
            class="close-btn"
            type="button"
            (click)="toggleFormOfferta()">
            Chiudi
          </button>

        </form>
      </div>
    }

    <!-- FOTO -->
    @if (inserzione.foto.length) {
      <div class="galleria">
        <img
          class="foto-principale"
          [src]="inserzione.foto[0].url"
          alt="Foto principale" />
      </div>
    }

    <!-- DETTAGLI -->
    @if (inserzione.dati) {
      <div class="dettagli">
        <h3>Dettagli</h3>

        <p><strong>Superficie:</strong> {{ inserzione.dati.dimensioni }} mÂ²</p>
        <p><strong>Stanze:</strong> {{ inserzione.dati.numeroStanze }}</p>
        <p><strong>Piano:</strong> {{ inserzione.dati.piano }}</p>
        <p><strong>Ascensore:</strong> {{ inserzione.dati.ascensore ? 'SÃ¬' : 'No' }}</p>
        <p><strong>Classe energetica:</strong> {{ inserzione.dati.classeEnergetica }}</p>
      </div>
    }

    <!-- DESCRIZIONE -->
    @if (inserzione.dati) {
      <div class="descrizione">
        <h3>Descrizione</h3>
        <p>{{ inserzione.dati.descrizione }}</p>
      </div>
    }

    <!-- POSIZIONE -->
    @if (inserzione.posizione) {
      <div class="posizione">
        <h3>Posizione</h3>
        <p>{{ inserzione.posizione.descrizione }}</p>

        <iframe
          width="100%"
          height="300"
          [src]="mappaUrl">
        </iframe>
      </div>
    }

  </div>
}
