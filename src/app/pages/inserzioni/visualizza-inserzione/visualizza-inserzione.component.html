@if (caricamento) {
  <div class="loading">Caricamento inserzione...</div>
}

@if (!caricamento && inserzione) {
  <div class="container-inserzione">

    <div class="header">
      <h1>{{ inserzione.dati.titolo }}</h1>
      <div class="prezzo-dettaglio">
        {{ inserzione.dati.prezzo | currency:'EUR':'symbol':'1.0-0' }}
      </div>
    </div>


    <button
      class="proposta-btn"
      [disabled]="haTrattativaInCorso"
      (click)="toggleFormOfferta()">
      ðŸ’¶ Fai un'offerta
    </button>

    @if (haTrattativaInCorso) {
      <p class="hint-trattativa">
        Hai giÃ  una trattativa in corso per questa inserzione.
      </p>
    }



    <!-- CONTROPROPOSTA AGENTE -->
    @if (contropropostaAgente && contropropostaAgente.stato === 'CONTROPROPOSTA') {
      <div class="alert-controproposta">

        <div class="alert-header">
          <span class="icon">ðŸ“©</span>
          <h3>Controproposta dellâ€™agente</h3>
        </div>

        <p class="alert-text">
          Lâ€™agente ha risposto alla tua offerta con un importo di
          <b>{{ contropropostaAgente.importo | currency:'EUR':'symbol':'1.0-0' }}</b>.
        </p>

        @if (contropropostaAgente.messaggio) {
          <p class="alert-note">
            <strong>Nota dellâ€™agente:</strong><br>
            {{ contropropostaAgente.messaggio }}
          </p>
        }

        <div class="alert-actions">
          <button class="btn-accetta" (click)="accettaControproposta()">
            âœ” Accetta
          </button>

          <button class="btn-rifiuta" (click)="rifiutaControproposta()">
            âœ– Rifiuta
          </button>
        </div>

        <p class="alert-reminder">
          Per continuare Ã¨ necessario accettare o rifiutare la controproposta.
        </p>

      </div>
    }




    <!-- MODAL OFFERTA -->
    @if (mostraFormOfferta && !haTrattativaInCorso) {
      <div class="overlay" (click)="toggleFormOfferta()"></div>

      <div class="modal-card">
        <h2>Invia una proposta</h2>

        <form [formGroup]="offertaForm" (ngSubmit)="inviaProposta()">
          <label>Importo offerta (â‚¬)</label>
          <input
            type="text"
            class="input-field"
            formControlName="prezzoProposta"
            appCurrencyInput />
          <small class="hint">
            Importo minimo consentito:
            <b>{{ prezzoMinimo | currency:'EUR':'symbol':'1.0-0' }}</b>.
            Ãˆ possibile inserire unâ€™offerta superiore al prezzo dellâ€™inserzione.
          </small>


          @if (prezzoProposta?.touched && prezzoProposta?.invalid) {
            <div class="text-danger mt-1">
              Inserisci un importo valido
            </div>
          }

          <label>Note (opzionale)</label>
          <textarea formControlName="note" class="textarea-field"></textarea>

          <button class="submit-btn" type="submit">Invia proposta</button>
          <button class="close-btn" type="button" (click)="toggleFormOfferta()">Chiudi</button>
        </form>
      </div>
    }

    @if (inserzione.foto.length) {
      <div class="galleria">
        <img
          class="foto-principale"
          [src]="inserzione.foto[0].url"
          alt="" />
      </div>
    }


    <div class="descrizione">
      <h3>Descrizione</h3>
      <p>{{ inserzione.dati.descrizione }}</p>
    </div>

    <div class="posizione">
      <h3>Posizione</h3>
      <iframe width="100%" height="300" [src]="mappaUrl"></iframe>
    </div>

  </div>
}
