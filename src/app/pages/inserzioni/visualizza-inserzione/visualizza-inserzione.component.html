@if (caricamento) {
<div class="loading">Caricamento inserzione...</div>
}

@if (!caricamento && inserzione) {
<div class="container-inserzione">

<<<<<<< HEAD
<!-- HEADER -->
@if (inserzione.dati) {
<div class="header">
  <h1>{{ inserzione.dati.titolo }}</h1>
=======
    <div class="header">
      <h1>{{ inserzione.dati.titolo }}</h1>
      <div class="prezzo-dettaglio">
        {{ inserzione.dati.prezzo | currency:'EUR':'symbol':'1.0-0' }}
      </div>
    </div>
    g
    <button
      class="proposta-btn"
      [disabled]="haTrattativaInCorso"
      (click)="toggleFormOfferta()">
      üí∂ Fai un'offerta
    </button>

    @if (isAgente()) {
      <button
        class="proposta-btn manuale"
        (click)="vaiAPropostaManuale()">
        üìù Inserisci offerta manuale
      </button>
    }

    @if (haTrattativaInCorso) {
      <p class="hint-trattativa">
        Hai gi√† una trattativa in corso per questa inserzione.
      </p>
    }



    <!-- CONTROPROPOSTA AGENTE -->
    @if (contropropostaAgente && contropropostaAgente.stato === 'CONTROPROPOSTA') {
      <div class="alert-controproposta">

        <div class="alert-header">
          <span class="icon">üì©</span>
          <h3>Controproposta dell‚Äôagente</h3>
        </div>

        <p class="alert-text">
          L‚Äôagente ha risposto alla tua offerta con un importo di
          <b>{{ contropropostaAgente.importo | currency:'EUR':'symbol':'1.0-0' }}</b>.
        </p>

        @if (contropropostaAgente.messaggio) {
          <p class="alert-note">
            <strong>Nota dell‚Äôagente:</strong><br>
            {{ contropropostaAgente.messaggio }}
          </p>
        }

        <div class="alert-actions">
          <button class="btn-accetta" (click)="accettaControproposta()">
            ‚úî Accetta
          </button>

          <button class="btn-rifiuta" (click)="rifiutaControproposta()">
            ‚úñ Rifiuta
          </button>
        </div>

        <p class="alert-reminder">
          Per continuare √® necessario accettare o rifiutare la controproposta.
        </p>

      </div>
    }




    <!-- MODAL OFFERTA -->
    @if (mostraFormOfferta && !haTrattativaInCorso) {
      <div class="overlay" (click)="toggleFormOfferta()"></div>

      <div class="modal-card">
        <h2>Invia una proposta</h2>

        <form [formGroup]="offertaForm" (ngSubmit)="inviaProposta()">
          <label>Importo offerta (‚Ç¨)</label>
          <input
            type="text"
            class="input-field"
            formControlName="prezzoProposta"
            appCurrencyInput />
          <small class="hint">
            Importo minimo consentito:
            <b>{{ prezzoMinimo | currency:'EUR':'symbol':'1.0-0' }}</b>.
            √à possibile inserire un‚Äôofferta superiore al prezzo dell‚Äôinserzione.
          </small>


          @if (prezzoProposta?.touched && prezzoProposta?.invalid) {
            <div class="text-danger mt-1">
              Inserisci un importo valido
            </div>
          }

          <label>Note (opzionale)</label>
          <textarea formControlName="note" class="textarea-field"></textarea>

          <button class="submit-btn" type="submit">Invia proposta</button>
          <button class="close-btn" type="button" (click)="toggleFormOfferta()">Chiudi</button>
        </form>
      </div>
    }

    @if (inserzione.foto.length) {
      <div class="galleria">
        <img
          class="foto-principale"
          [src]="inserzione.foto[0].url"
          alt="" />
      </div>
    }


    <div class="descrizione">
      <h3>Descrizione</h3>
      <p>{{ inserzione.dati.descrizione }}</p>
    </div>

    <div class="posizione">
      <h3>Posizione</h3>
      <iframe width="100%" height="300" [src]="mappaUrl"></iframe>
    </div>
>>>>>>> nives

  <div class="prezzo-dettaglio">
    {{ inserzione.dati.prezzo | currency:'EUR':'symbol':'1.0-0' }}
  </div>
</div>
}

<!-- BOTTONI -->
<button
class="proposta-btn"
[disabled]="haTrattativaInCorso"
(click)="toggleFormOfferta()">
üí∂ Fai un'offerta
</button>

@if (isAgente()) {
<button
  class="proposta-btn manuale"
  (click)="vaiAPropostaManuale()">
  üìù Inserisci offerta manuale
</button>
}

@if (haTrattativaInCorso) {
<p class="hint-trattativa">
  Hai gi√† una trattativa in corso per questa inserzione.
</p>
}

<!-- CONTROPROPOSTA -->
@if (contropropostaAgente && contropropostaAgente.stato === 'CONTROPROPOSTA') {
<div class="alert-controproposta">
  <h3>üì© Controproposta dell‚Äôagente</h3>

  <p>
    Importo:
    <b>{{ contropropostaAgente.importo | currency:'EUR':'symbol':'1.0-0' }}</b>
  </p>

  @if (contropropostaAgente.messaggio) {
  <p>
    <strong>Nota:</strong><br />
  {{ contropropostaAgente.messaggio }}
  </p>
  }

  <button (click)="accettaControproposta()">‚úî Accetta</button>
  <button (click)="rifiutaControproposta()">‚úñ Rifiuta</button>
</div>
}

<!-- MODAL OFFERTA -->
@if (mostraFormOfferta && !haTrattativaInCorso) {
<div class="overlay" (click)="toggleFormOfferta()"></div>

<div class="modal-card">
  <h2>Invia una proposta</h2>

  <form [formGroup]="offertaForm" (ngSubmit)="inviaProposta()">

    <label>Importo offerta (‚Ç¨)</label>
    <input
      type="text"
      class="input-field"
      formControlName="prezzoProposta"
      appCurrencyInput />

    @if (prezzoProposta?.touched && prezzoProposta?.invalid) {
    <div class="text-danger">
      Minimo accettato:
      <b>{{ prezzoMinimo | currency:'EUR':'symbol':'1.0-0' }}</b>
            </div>
    }

    <label>Note (opzionale)</label>
    <textarea formControlName="note"></textarea>

    <button type="submit">Invia proposta</button>
    <button type="button" (click)="toggleFormOfferta()">Chiudi</button>
  </form>
</div>
}

<!-- FOTO -->
@if (inserzione.foto?.length) {
<div class="galleria">
  <img
    class="foto-principale"
    [src]="inserzione.foto[0].url"
    alt="Foto principale" />
</div>
}

<!-- DETTAGLI -->
@if (inserzione.dati) {
<div class="dettagli">
  <h3>Dettagli</h3>
  <p><strong>Superficie:</strong> {{ inserzione.dati.dimensioni }} m¬≤</p>
  <p><strong>Stanze:</strong> {{ inserzione.dati.numeroStanze }}</p>
  <p><strong>Piano:</strong> {{ inserzione.dati.piano }}</p>
  <p><strong>Ascensore:</strong> {{ inserzione.dati.ascensore ? 'S√¨' : 'No' }}</p>
  <p><strong>Classe energetica:</strong> {{ inserzione.dati.classeEnergetica }}</p>
</div>
}

<!-- DESCRIZIONE -->
@if (inserzione.dati) {
<div class="descrizione">
  <h3>Descrizione</h3>
  <p>{{ inserzione.dati.descrizione }}</p>
</div>
}

<!-- INDICATORI -->
@if (inserzione.indicatore) {
<div class="indicatori">
  <h3>Servizi nelle vicinanze</h3>
  <p>üè´ Scuole: <strong>{{ inserzione.indicatore.scuoleVicine ? 'S√¨' : 'No' }}</strong></p>
  <p>üå≥ Parchi: <strong>{{ inserzione.indicatore.parchiVicini ? 'S√¨' : 'No' }}</strong></p>
  <p>üöâ Mezzi pubblici: <strong>{{ inserzione.indicatore.mezziPubbliciVicini ? 'S√¨' : 'No' }}</strong></p>
</div>
}

<!-- POSIZIONE -->
@if (inserzione.posizione) {
<div class="posizione">
  <h3>Posizione</h3>
  <p>{{ inserzione.posizione.indirizzo }}</p>
  <iframe width="100%" height="300" [src]="mappaUrl"></iframe>
</div>
}

</div>
}


