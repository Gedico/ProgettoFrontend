@if (caricamento) {
<div class="loading">Caricamento inserzione...</div>
}

@if (!caricamento && inserzione) {
<div class="container-inserzione">

<!-- HEADER -->
@if (inserzione.dati) {
<div class="header">
  <h1>{{ inserzione.dati.titolo }}</h1>

  <div class="prezzo-dettaglio">
    {{ inserzione.dati.prezzo | currency:'EUR':'symbol':'1.0-0' }}
  </div>
</div>
}

<!-- BOTTONI -->
<button
class="proposta-btn"
[disabled]="haTrattativaInCorso"
(click)="toggleFormOfferta()">
ğŸ’¶ Fai un'offerta
</button>

@if (isAgente()) {
<button
  class="proposta-btn manuale"
  (click)="vaiAPropostaManuale()">
  ğŸ“ Inserisci offerta manuale
</button>
}

@if (haTrattativaInCorso) {
<p class="hint-trattativa">
  Hai giÃ  una trattativa in corso per questa inserzione.
</p>
}

<!-- CONTROPROPOSTA -->
@if (contropropostaAgente && contropropostaAgente.stato === 'CONTROPROPOSTA') {
<div class="alert-controproposta">
  <h3>ğŸ“© Controproposta dellâ€™agente</h3>

  <p>
    Importo:
    <b>{{ contropropostaAgente.importo | currency:'EUR':'symbol':'1.0-0' }}</b>
  </p>

  @if (contropropostaAgente.messaggio) {
  <p>
    <strong>Nota:</strong><br />
  {{ contropropostaAgente.messaggio }}
  </p>
  }

  <button (click)="accettaControproposta()">âœ” Accetta</button>
  <button (click)="rifiutaControproposta()">âœ– Rifiuta</button>
</div>
}

<!-- MODAL OFFERTA -->
@if (mostraFormOfferta && !haTrattativaInCorso) {
<div class="overlay" (click)="toggleFormOfferta()"></div>

<div class="modal-card">
  <h2>Invia una proposta</h2>

  <form [formGroup]="offertaForm" (ngSubmit)="inviaProposta()">

    <label>Importo offerta (â‚¬)</label>
    <input
      type="text"
      class="input-field"
      formControlName="prezzoProposta"
      appCurrencyInput />

    @if (prezzoProposta?.touched && prezzoProposta?.invalid) {
    <div class="text-danger">
      Minimo accettato:
      <b>{{ prezzoMinimo | currency:'EUR':'symbol':'1.0-0' }}</b>
            </div>
    }

    <label>Note (opzionale)</label>
    <textarea formControlName="note"></textarea>

    <button type="submit">Invia proposta</button>
    <button type="button" (click)="toggleFormOfferta()">Chiudi</button>
  </form>
</div>
}

<!-- FOTO -->
@if (inserzione.foto?.length) {
<div class="galleria">
  <img
    class="foto-principale"
    [src]="inserzione.foto[0].url"
    alt="Foto principale" />
</div>
}

<!-- DETTAGLI -->
@if (inserzione.dati) {
<div class="dettagli">
  <h3>Dettagli</h3>
  <p><strong>Superficie:</strong> {{ inserzione.dati.dimensioni }} mÂ²</p>
  <p><strong>Stanze:</strong> {{ inserzione.dati.numeroStanze }}</p>
  <p><strong>Piano:</strong> {{ inserzione.dati.piano }}</p>
  <p><strong>Ascensore:</strong> {{ inserzione.dati.ascensore ? 'SÃ¬' : 'No' }}</p>
  <p><strong>Classe energetica:</strong> {{ inserzione.dati.classeEnergetica }}</p>
</div>
}

<!-- DESCRIZIONE -->
@if (inserzione.dati) {
<div class="descrizione">
  <h3>Descrizione</h3>
  <p>{{ inserzione.dati.descrizione }}</p>
</div>
}

<!-- INDICATORI -->
@if (inserzione.indicatore) {
<div class="indicatori">
  <h3>Servizi nelle vicinanze</h3>
  <p>ğŸ« Scuole: <strong>{{ inserzione.indicatore.scuoleVicine ? 'SÃ¬' : 'No' }}</strong></p>
  <p>ğŸŒ³ Parchi: <strong>{{ inserzione.indicatore.parchiVicini ? 'SÃ¬' : 'No' }}</strong></p>
  <p>ğŸš‰ Mezzi pubblici: <strong>{{ inserzione.indicatore.mezziPubbliciVicini ? 'SÃ¬' : 'No' }}</strong></p>
</div>
}

<!-- POSIZIONE -->
@if (inserzione.posizione) {
<div class="posizione">
  <h3>Posizione</h3>
  <p>{{ inserzione.posizione.indirizzo }}</p>
  <iframe width="100%" height="300" [src]="mappaUrl"></iframe>
</div>
}

</div>
}


