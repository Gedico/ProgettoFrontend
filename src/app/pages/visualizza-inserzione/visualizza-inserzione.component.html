<!-- Stato di caricamento -->
<div *ngIf="caricamento" class="loading">
  Caricamento inserzione...
</div>

<!-- Contenuto principale -->
<div *ngIf="!caricamento && inserzione" class="container-inserzione">

  <!-- Titolo + Prezzo -->
  <div class="header">
    <h1>{{ inserzione.dati.titolo }}</h1>
    <h2>{{ inserzione.dati.prezzo | currency:'EUR':'symbol':'1.0-0' }}</h2>

    <!-- ⭐⭐⭐ BOTTONE OFFERTA ⭐⭐⭐ -->
    <button
      class="btn btn-primary"
      style="margin-top: 15px;"
      (click)="toggleFormOfferta()">
      {{ mostraFormOfferta ? 'Nascondi offerta' : 'Fai un\'offerta' }}
    </button>
  </div>

  <!-- ⭐⭐⭐ CARD FORM OFFERTA ⭐⭐⭐ -->
  <div *ngIf="mostraFormOfferta" class="card-offerta">

    <h4>Invia una proposta</h4>

    <form [formGroup]="offertaForm" (ngSubmit)="inviaProposta()">

      <div class="form-group">
        <label>Importo offerta (€)</label>
        <input type="number" formControlName="prezzoProposta" />

        <small *ngIf="prezzoProposta?.touched && prezzoProposta?.invalid"
               style="color: red;">
          Importo minimo accettabile: €{{ prezzoMinimo | number:'1.0-0' }}
        </small>
      </div>

      <div class="form-group">
        <label>Note (opzionale)</label>
        <textarea rows="2" formControlName="note"></textarea>
      </div>

      <button type="submit">
        Invia proposta
      </button>
    </form>

  </div>
  <!-- ⭐⭐⭐ FINE CARD ⭐⭐⭐ -->

  <!-- Galleria foto -->
  <div class="galleria">
    <img class="foto-principale" [src]="inserzione.foto[0].url" alt="Foto principale" />

    <div class="foto-secondarie">
      <img
        *ngFor="let f of inserzione.foto.slice(1)"
        [src]="f.url"
        alt="Foto inserzione"
      />
    </div>
  </div>

  <!-- Dettagli -->
  <div class="dettagli">
    <h3>Dettagli</h3>

    <p><strong>Superficie:</strong> {{ inserzione.dati.dimensioni }} m²</p>
    <p><strong>Stanze:</strong> {{ inserzione.dati.numeroStanze }}</p>
    <p><strong>Piano:</strong> {{ inserzione.dati.piano }}</p>
    <p><strong>Ascensore:</strong> {{ inserzione.dati.ascensore ? 'Sì' : 'No' }}</p>
    <p><strong>Classe energetica:</strong> {{ inserzione.dati.classeEnergetica }}</p>
  </div>

  <!-- Descrizione -->
  <div class="descrizione">
    <h3>Descrizione</h3>
    <p>{{ inserzione.dati.descrizione }}</p>
  </div>

  <!-- Posizione -->
  <div class="posizione">
    <h3>Posizione</h3>
    <p>{{ inserzione.posizione.descrizione }}</p>

    <iframe
      width="100%"
      height="300"
      style="border:0; margin-top: 10px;"
      loading="lazy"
      allowfullscreen
      [src]="mappaUrl">
    </iframe>
  </div>

</div>
