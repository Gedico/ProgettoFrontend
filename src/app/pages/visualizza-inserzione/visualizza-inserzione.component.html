<div *ngIf="caricamento" class="loading">Caricamento inserzione...</div>

<div *ngIf="!caricamento && inserzione" class="container-inserzione">

  <div class="header">
    <h1>{{ inserzione.dati.titolo }}</h1>
    <h2>{{ inserzione.dati.prezzo | currency:'EUR':'symbol':'1.0-0' }}</h2>

    <button class="btn-offerta" (click)="toggleFormOfferta()">
      ðŸ’¸ Fai un'offerta
    </button>
  </div>

  <!-- Overlay -->
  <div class="modal-overlay" *ngIf="mostraFormOfferta" (click)="chiudiModal()"></div>

  <!-- Modal -->
  <div class="modal-card" *ngIf="mostraFormOfferta">

    <h3>Invia una proposta</h3>

    <form [formGroup]="offertaForm" (ngSubmit)="inviaProposta()">

      <div class="form-group">
        <label>Importo offerta</label>

        <div class="input-icon">
          <span>â‚¬</span>
          <input type="number" formControlName="prezzoProposta" />
        </div>

        <small *ngIf="prezzoProposta?.touched && prezzoProposta?.invalid">
          Minimo accettato: â‚¬{{ prezzoMinimo | number:'1.0-0' }}
        </small>
      </div>

      <div class="form-group">
        <label>Note (opzionale)</label>
        <textarea rows="2" formControlName="note"></textarea>
      </div>

      <button class="btn-submit" type="submit">Invia proposta</button>
      <button class="btn-close" type="button" (click)="chiudiModal()">Chiudi</button>

    </form>

  </div>

  <!-- Galleria foto -->
  <div class="galleria">
    <img class="foto-principale" [src]="inserzione.foto[0].url" />

    <div class="foto-secondarie">
      <img *ngFor="let f of inserzione.foto.slice(1)" [src]="f.url" />
    </div>
  </div>

  <div class="dettagli">
    <h3>Dettagli</h3>
    <p><strong>Superficie:</strong> {{ inserzione.dati.dimensioni }} mÂ²</p>
    <p><strong>Stanze:</strong> {{ inserzione.dati.numeroStanze }}</p>
    <p><strong>Piano:</strong> {{ inserzione.dati.piano }}</p>
    <p><strong>Ascensore:</strong> {{ inserzione.dati.ascensore ? 'SÃ¬' : 'No' }}</p>
    <p><strong>Classe energetica:</strong> {{ inserzione.dati.classeEnergetica }}</p>
  </div>

  <div class="descrizione">
    <h3>Descrizione</h3>
    <p>{{ inserzione.dati.descrizione }}</p>
  </div>

  <div class="posizione">
    <h3>Posizione</h3>
    <p>{{ inserzione.posizione.descrizione }}</p>

    <iframe
      width="100%"
      height="300"
      loading="lazy"
      allowfullscreen
      style="border:0; margin-top: 10px;"
      [src]="mappaUrl">
    </iframe>
  </div>

</div>
